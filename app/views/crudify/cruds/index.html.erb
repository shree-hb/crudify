<% content_for :dynamic_view do %>
  <%= render 'crudify/cruds/partials/index' %>
<% end %>

<%= render 'crudify/cruds/shared/common' %>

<script type="text/javascript">
    document.getElementById('deleteLink').addEventListener('click', function(event) {
      event.preventDefault();

      var parentRecords = [];
      var childRecords = [];

      Array.from(document.querySelectorAll('.record-checkbox:checked')).forEach(cb => {
          if (cb.dataset.type === 'regular') {
              parentRecords.push(cb.value);
          } else if (cb.dataset.type === 'child') {
              childRecords.push(cb.value);
          }
      });

      var model = document.getElementById('slected_model').value;

      if (parentRecords.length === 0 && childRecords.length === 0) {
          return alert('Please select records to delete.');
      }

      if (!confirm('Are you sure you want to delete the selected records?')) {
          return;
      }

      var url = `/crudify/delete_content/?model=${model}`;
      if (parentRecords.length > 0) {
          url += `&parent_records=${encodeURIComponent(parentRecords.join(','))}`;
      }
      if (childRecords.length > 0) {
          url += `&child_records=${encodeURIComponent(childRecords.join(','))}`;
      }

      fetch(url)
        .then(response => {
          if (response.ok) {
              return response.text();
          } else {
              throw new Error('Failed to delete');
          }
      })
      .then(script => {
          eval(script);
      })
      .catch(error => console.error('Error:', error));
  });
</script>